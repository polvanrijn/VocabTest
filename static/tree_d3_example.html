<html lang="en">
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Bootstrap demo</title>
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha3/dist/css/bootstrap.min.css" rel="stylesheet"
      integrity="sha384-KK94CHFLLe+nY2dmCWGMq91rCGa5gtU4mk92HdvYe+M/SXH301p5ILy+dN9+nJOZ" crossorigin="anonymous">

<style>
    html, body {
        margin: 0;
        padding: 0;
        background-color: white;
    }

    .node {
        cursor: pointer;
    }

    .node circle {
    }

    .node text {
        font: 10px sans-serif;
    }

    .link {
        fill: none;
        stroke: var(--bs-dark-bg-subtle);
        stroke-width: 1px;
    }
</style>


</head>

<body translate="no">
<div class="container">
    <div class="row">
        <div class="col-12">
            <h1>Pick a vocabulary test</h1>
        </div>
    </div>

    <div class="row">
        <div class="col-12">
            <form>
                <div class="mb-3">
                    <input type="email" class="form-control" id="exampleInputEmail1"
                           placeholder="Start typing the language and pick it from the list">
                    <div id="emailHelp" class="form-text">The selected language will also show up below</div>
                </div>
            </form>
            <div id="tree-container"></div>
        </div>
    </div>
</div>


<script src="https://cpwebassets.codepen.io/assets/common/stopExecutionOnTimeout-2c7831bb44f98c1391d6a4ffda0e1fd302503391ca806e7fcc7b9b87197aec26.js"></script>

<script src="https://cdnjs.cloudflare.com/ajax/libs/d3/4.2.2/d3.min.js"></script>
<script id="rendered-js">
    // var treeData = {
    //     name: "T",
    //     children: [
    //         {
    //             name: "A",
    //             children: [
    //                 {name: "A1"},
    //                 {name: "A2"},
    //                 {name: "A3"},
    //                 {name: "A4"},
    //                 {
    //                     name: "C",
    //
    //                     children: [
    //                         {name: "C1"},
    //                         {
    //                             name: "D",
    //                             children: [{name: "D1"}, {name: "D2"}]
    //                         }]
    //                 }]
    //         },
    //
    //
    //         {name: "Z"},
    //         {
    //             name: "B",
    //             children: [{name: "B1"}, {name: "B2"}, {name: "B3"}]
    //         }]
    // };

    d3.json("tree.json", function (error, treeData) {
        var margin = {top: 20, right: 90, bottom: 30, left: 90},
            width = 960 - margin.left - margin.right,
            height = 10000 - margin.top - margin.bottom;
        var svg = d3.select("#tree-container").append("svg").attr("width", width + margin.right + margin.left).attr("height", height + margin.top + margin.bottom).append("g").attr("transform", "translate(" + margin.left + "," + margin.top + ")");

        // TODO implement zoom and pan

        var root_node_background = "var(--bs-warning)";
        var normal_node_background = "var(--bs-primary-bg-subtle)";
        var normal_node_border = "var(--bs-primary-border-subtle)";
        var root_node_text_color = "var(--bs-dark)";
        var normal_node_text_color = "var(--bs-primary)";

        var leaf_text_color = "var(--bs-primary)";

        var color_link_active = "var(--bs-dark-border-subtle)";


        var i = 0,
            duration = 750,
            root;
        var treemap = d3.tree().size([height, width]);
        root = d3.hierarchy(treeData, function (d) {
            return d.children;
        });
        root.x0 = height / 2;
        root.y0 = 0;
        root.children.forEach(collapse);

        update(root);

        function collapse(d) {
            if (d.children) {
                d._children = d.children;
                d._children.forEach(collapse);
                d.children = null;
            }
        }

        function update(source) {
            var treeData = treemap(root);
            var nodes = treeData.descendants(),
                links = treeData.descendants().slice(1);
            nodes.forEach(function (d) {
                d.y = d.depth * 180;
            });
            var node = svg.selectAll("g.node").data(nodes, function (d) {
                return d.id || (d.id = ++i);
            });
            var nodeEnter = node.enter().append("g").attr("class", "node").attr("transform", function (d) {
                return "translate(" + source.y0 + "," + source.x0 + ")";
            }).on("click", click);
            nodeEnter.attr("class", "node").attr("r", 1e-6).style("fill", function (d) {

                if (d.parent) {
                    return d.children || d._children ? normal_node_background : "#fff";
                }
                return root_node_background;
            });
            nodeEnter.append("rect").attr("rx", function (d) {
                if (d.parent) return d.children || d._children ? 0 : 6;
                return 10;
            }).attr("ry", function (d) {
                if (d.parent) return d.children || d._children ? 0 : 6;
                return 10;
            }).attr("stroke-width", function (d) {
                return d.parent ? 1 : 0;
            }).attr("stroke", function (d) {
                return d.children || d._children ?
                    normal_node_border :
                    color_link_active;
            }).attr("stroke-dasharray", function (d) {
                return d.children || d._children ? "0" : "2.2";
            }).attr("stroke-opacity", function (d) {
                return d.children || d._children ? "1" : "0.6";
            }).attr("x", 0).attr("y", -10).attr("width", function (d) {
                return d.parent ? 40 : 20;
            }).attr("height", 20);

            nodeEnter.append("text").style("fill", function (d) {
                if (d.parent) {
                    return d.children || d._children ? normal_node_text_color : "var(--bs-dark-bg-subtle)";
                }
                return root_node_text_color;
            }).attr("dy", ".35em").attr("x", function (d) {
                return d.parent ? 20 : 10;
            }).attr("text-anchor", function (d) {
                return "middle";
            }).text(function (d) {
                return d.data.name;
            });

            var nodeUpdate = nodeEnter.merge(node);

            nodeUpdate.transition().duration(duration).attr("transform", function (d) {
                return "translate(" + d.y + "," + d.x + ")";
            });
            var nodeExit = node.exit().transition().duration(duration).attr("transform", function (d) {
                return "translate(" + source.y + "," + source.x + ")";
            }).remove();
            nodeExit.select("rect").style("opacity", 1e-6);
            nodeExit.select("rect").attr("stroke-opacity", 1e-6);
            nodeExit.select("text").style("fill-opacity", 1e-6);
            var link = svg.selectAll("path.link").data(links, function (d) {
                return d.id;
            });
            var linkEnter = link.enter().insert("path", "g").attr("class", "link").attr("d", function (d) {
                var o = {x: source.x0, y: source.y0};
                return diagonal(o, o);
            });
            var linkUpdate = linkEnter.merge(link);
            linkUpdate.transition().duration(duration).attr("d", function (d) {
                return diagonal(d, d.parent);
            });
            var linkExit = link.exit().transition().duration(duration).attr("d", function (d) {
                var o = {x: source.x, y: source.y};
                return diagonal(o, o);
            }).remove();
            nodes.forEach(function (d) {
                d.x0 = d.x;
                d.y0 = d.y;
            });

            function diagonal(s, d) {
                path = `M ${s.y} ${s.x}
            C ${(s.y + d.y) / 2} ${s.x},
              ${(s.y + d.y) / 2} ${d.x},
              ${d.y} ${d.x}`;

                return path;
            }

            function click(d) {
                if (d.children) {
                    d._children = d.children;
                    d.children = null;
                } else {
                    d.children = d._children;
                    d._children = null;
                }
                update(d);
            }
        }

    });
</script>


</body>
</html>